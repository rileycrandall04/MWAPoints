<full corrected version would go here, based on previous message — fixed indentation and logic throughout>